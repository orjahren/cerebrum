#!/bin/bash
#kommenterte ut 15min kjøringene i crontab
#stoppe bofhd?
#legge inn melding på profil.uit.no sia?


#09:10
#kjørte import ihht bas_howto.html som ligg på hood.

#studen import

cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/create_import_data
python import_from_FS.py --db-user=fsbas --db-service=fsprod -s -o -p -f -e -u -U
python fnr_update.py /cerebrum/dumps/FS/fnr_update.xml
python      /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_export/run_all.py -u /cerebrum/dumps/FS/underv_enhet.xml
python      /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_export/run_all.py -U /cerebrum/dumps/FS/emner.xml
cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/create_import_data 
python   merge_xml_files.py  -d  fodselsdato:personnr  -f  /cerebrum/dumps/FS/person.xml  -t  person  -o /cerebrum/dumps/FS/merged_persons.xml
python import_FS.py -s /cerebrum/dumps/FS/studieprog.xml -p /cerebrum/dumps/FS/merged_persons.xml -g 


#ou xml fil
cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/create_import_data
python generate_OU.py -r -f source_data/fs-sted.txt -o source_data/stedkoder_v2.txt   -O /cerebrum/dumps/FRIDA/uit_ou_20060302.xml
cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_import
python   import_OU.py   -v   -o  /cerebrum/dumps/FRIDA/uit_ou_20060302.xml  --perspective=perspective_fs --source-system=system_fs

# ansatte
cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/create_import_data/
python get_user_info.py
python get_slp4_data.py
cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/create_import_data/misc_scripts    
python parse_user_info.py -e 
cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/create_import_data  
python generate_persons.py -t AD
cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_import
python import_LT.py -p /cerebrum/dumps/FRIDA/uit_persons_20060302.xml


#sys-X
python /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_export/run_all.py -G

# gen kontoer
cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_import
python  process_students.py  -C  /cerebrum/dumps/FS/studconfig.xml  -S  /cerebrum/dumps/FS/studieprog.xml  -s /cerebrum/dumps/FS/merged_persons.xml  -c  -u -e /cerebrum/dumps/FS/emner.xml --only-dump-results result_file.txt --workdir .

cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_import
python  generate_user_accounts.py  -f 0 -i 0 -e ../create_import_data/source_data/email_conversion_list.txt -p ad_user_password_020904.txt



# exports
#fronter
cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_export
python populate_external_groups.py
python export_xml_fronter.py
mv /cerebrum/dumps/Fronter/test.xml /cerebrum/dumps/Fronter/uit_import20060302.xml


#frida
cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_export/FRIDA
python generate_frida_export.py -p /cerebrum/dumps/FRIDA/uit_persons_20060302.xml -s /cerebrum/dumps/FRIDA/uit_ou_20060302.xml -o /cerebrum/dumps/FRIDA/frida_20060302.xml

#ldap
cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_export
python run_all.py -l -o /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_export/uit_persons

#sut
cd /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_export
python run_all.py -s -o /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_export/uit_persons


# Ovenfor tar ca 40-45min


#Filer til kopiering for sammenligning:
rm -r ~/migrate
mkdir ~/migrate
mkdir ~/migrate/imports
mkdir ~/migrate/exports

#imports
#FS:
cp /cerebrum/dumps/FS/*.xml ~/migrate/imports

# ansatte / AD filer
cp /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/create_import_data/source_data/static_user_info.txt ~/migrate/imports
cp /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/create_import_data/source_data/stedkoder_v2.txt  ~/migrate/imports
cp /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/create_import_data/source_data/slp4_personer_20060302.txt ~/migrate/imports
cp /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/create_import_data/source_data/ad/*.csv ~/migrate/imports




#exports:
#fronter
cp /cerebrum/dumps/Fronter/uit_import20060302.xml ~/migrate/exports
#frida
cp /cerebrum/dumps/FRIDA/frida_20060302.xml ~/migrate/exports
cp /cerebrum/dumps/FRIDA/uit_ou_20060302.xml ~/migrate/exports
cp /cerebrum/dumps/FRIDA/uit_persons_20060302.xml ~/migrate/exports
#ldap
cp /cerebrum/dumps/LDAP/uit_ldif ~/migrate/exports
#sysx
cp /cerebrum/dumps/System_x/guest_data ~/migrate/imports/sysX_guest_data
#sut
cp /home/cerebrum/CVS/cerebrum_H05/cerebrum/contrib/no/uit/cerebrum_export/uit_persons ~/migrate/exports/sut_data


#su - 
#su - postgres
#/usr/bin/pg_dump cerebrum -f /its/powaqqatsi/backup/cerebrum_dump
##cp /its/powaqqatsi/backup/cerebrum_dump /its/powaqqatsi/backup/cerebrum_dump_20060302_caesarmig
#
## tilbake til cerebrum bruker
##cp /its/powaqqatsi/backup/cerebrum_dump_20060302_caesarmig ~/migrate
#
#
## Slett migrate katalogen på caesar
#/usr/bin/ssh cerebrum@caesar.uit.no rm -r ~/migrate     
## Kopier migrate katalogen til caesar
#/usr/bin/scp -r ~/migrate cerebrum@caesar.uit.no:.
#
#
#
## SKIFT TIL CAESAR:
#avslutt alle bofhd's + psql terms + spine på caesar.
#
#uit
#cd misc
#./rebuild_db.sh ~/migrate/cerebrum_dump_20060302_caesarmig

#
# Fjern 4902 gruppene

## 
#kjør exports..... verify
#
#kjør imports .... verify
#
#kjør process.... verify
#
#kjør exports... verify
#
#
# Sjekk inn filer i CVS
# Oppdater setup.py  hvis nødvendig
